<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
  layout:decorator="@{layout/default}">
	<th:block layout:fragment="customCss">
		<link href="plugins/colorbox/colorbox.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.carousel.css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.theme.default.css">
		<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/animate.css">
		<link rel="stylesheet" type="text/css" href="styles/course.css">
		<link rel="stylesheet" type="text/css" href="styles/course_responsive.css">
		<link rel="stylesheet" type="text/css" href="styles/blog_single.css">
		<link rel="stylesheet" type="text/css" href="styles/blog_single_responsive.css">
		<link rel="stylesheet" type="text/css" href="styles/courses.css">
		<link rel="stylesheet" type="text/css" href="styles/courses_responsive.css">
		<style>
		.input_from
		{
		    margin-bottom: 20px;
		}
		.contact_form{
			 padding-left: 200px;
    		padding-right: 200px;
		}
		</style>
	</th:block>
	
	<th:block layout:fragment="customTitle">
	<title> 회원가입 </title>
	</th:block>
	
	<th:block layout:fragment="customHeader">
		<nav class="main_nav_contaner ml-auto">
			<ul class="main_nav">
				<li><a href="bookList">통합검색(서)</a></li>
				<li class="active"><a href="myLibrary">나의 도서관(서)</a></li>
				<li><a href="#">#공지사항</a></li>
				<li><a href="libraryList">이용안내(유)</a></li>
				<li><a href="#">#도서관 위치</a></li>
			</ul>
			<div class="search_button"><i class="fa fa-search" aria-hidden="true"></i></div>
		</nav>
	</th:block>
	
	<th:block layout:fragment="customContents">
		<div class="home">
			<div class="breadcrumbs_container">
				<div class="container">
					<div class="row">
						<div class="col">
							<div class="breadcrumbs">
								<ul>
									<li><a href="index">EveryBook(유)</a></li>
									<li><a href="addMember">회원가입(김)</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="course">
			<div class="contact">
				<div class="contact_info_container">
					<div class="container">
						<div class="row">
							<div class="col-lg-12">
								<div class="contact_form">
									<form action="addMember" class="comment_form" method="post">
										<div class="input_from">
											<div class="form_title">아이디</div>
											<input type="text" name = "memberId" id="memberId" class="comment_input" required="required">
											<label id="memberIdCk" style="color: red; display: none;"></label>
										</div>
										<div class="input_from">
											<div class="form_title">비밀번호</div>
											<input type="password" name = "memberPw" id="memberPw" class="comment_input" required="required">
											<label id="memberPwCk" style="color: red; display: none;">비밀번호를 5자 이상 입력하세요.</label>
										</div>
										<div class="input_from">
											<div class="form_title">비밀번호 재확인</div>
											<input type="password" name = "memberPwRe" id="memberPwRe" class="comment_input" required="required">
											<label id="memberPwReCk" style="color: red; display: none;">비밀번호가 일치하지 않습니다.</label>
										</div>
										<div class="input_from">
											<div class="form_title">이름</div>
											<input type="text" name = "memberName" class="comment_input" required="required">
										</div>
										<div class="input_from">
											<div class="form_title">생년월일</div>
											<input type="date" name = "memberBirth" class="comment_input" required="required">
										</div>
										<div class="input_from">
											<div class="form_title">주소</div>
											<div class="row">
												<div class="col-md-6 input_col">
													<select name = "regionMagjor" id="regionMagjor" class="courses_search_select courses_search_input" data-checked="N">
														<option>도</option>
														<option th:each=" r: ${regionMagjor}" th:value="${r.regionMajor}">[[${r.regionMajor}]]</option>
													</select>
													<label id="regionMagjorCk" style="color: red; display: none;">지역(도)를 선택하세요</label>
												</div>
												<div class="col-md-6 input_col">
													<select name = "regionMinor" id="regionMinor" class="courses_search_select courses_search_input" data-checked="N">
														<option>시</option>
													</select>
													<label id="regionMinorCk" style="color: red; display: none;">지역(시)를 선택하세요</label>
												</div>
											</div>
											<hr>
											<input type="text" name = "regionDetail" id="regionDetail" class="comment_input" placeholder="상세주소" required="required">
											<input type="text" name = "memberAddress" id="memberAddress" style="display: none;">
										</div>
										<div class="input_from">
											<div class="form_title">휴대폰번호</div>
											<input type="text" name = "memberTel" class="comment_input" required="required">
										</div>
										<div class="input_from">
											<div class="form_title">이메일</div>
											<input type="text" name = "memberEmail" class="comment_input" required="required">
										</div>
										<div class="input_from">
											<div class="form_title">도서관</div>
											<select name = "libraryCode" id="libraryName" class="courses_search_select courses_search_input" data-checked="N">
												<option>주변 도서관</option>
											</select>
											<label id="libraryNameCk" style="color: red; display: none;">도서관을 선택하세요</label>
										</div>
										<div class="input_from" style ="display: none;">
											<input type="text" name = "officerId" id="officerId" value="%00">
										</div>
										<div style="float: right;">
											<button type="submit" class="comment_button">회원가입</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>		
			</div>
		</div>	
	</th:block>
	
	<th:block layout:fragment="customFooterScript">
		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="styles/bootstrap4/popper.js"></script>
		<script src="styles/bootstrap4/bootstrap.min.js"></script>
		<script src="plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
		<script src="plugins/easing/easing.js"></script>
		<script src="plugins/parallax-js-master/parallax.min.js"></script>
		<script src="plugins/colorbox/jquery.colorbox-min.js"></script>
		<script src="js/courses.js"></script>
		<script src="js/course.js"></script>
		<script>
			$(function(){
				
	  			var memberId = $('#memberId');
	  			var memberIdCk = $('#memberIdCk');
	  			
	  			var memberPw = $('#memberPw');
	  			var memberPwCk = $('#memberPwCk');
	  			
	  			var memberPwRe = $('#memberPwRe');
	  			var memberPwReCk = $('#memberPwReCk');
	  			
	  			var regionMagjor = $('#regionMagjor');
	  			var regionMinor = $('#regionMinor');
	  			var libraryName = $('#libraryName');
	  			var regionMagjorCk = $('#regionMagjorCk');
	  			var regionMinorCk = $('#regionMinorCk');
	  			var libraryNameCk = $('#libraryNameCk');
		  		
	  			
	  			memberId.keyup(function(){
	  				
					/* 아이디 글자수 제한 */
					/* 아이디 중복체크 */
					var request = $.ajax({
						  url: "/selectCheckMemberId",
						  method: "get",
						  data: { memberId : memberId.val() },
						  dataType: "json"
					});
	 			 
					request.done(function( data ) {
						console.log(data);
						if(memberId.val().length < 5){
							memberIdCk.show();
		  					memberIdCk.text("아이디를 5자 이상 입력하세요.");
						}
						if(data == false){
							memberIdCk.text("중복된 아이디가 존재합니다.");
						}
						if(memberId.val().length >= 5 && data == true){
							memberIdCk.hide();
						}
						if(memberId.val().length == 0){
							memberIdCk.hide();
						}
					});
					 
					request.fail(function( jqXHR, textStatus ) {
						alert( "Request failed: " + textStatus );
					}); 
						
						
				});
				
  				/* 비밀번호 글자수 제한 */
	  			memberPw.keyup(function(){
	  				
	  				if(memberPw.val().length < 5){
	  					memberPwCk.show();
					}
					if(memberPw.val().length >= 5){
						memberPwCk.hide();
					}				
					if(memberPwRe.val() !== memberPw.val()){
						memberPwReCk.show();
	  				}
	  			})
	  			
	  			/* 비밀번호 재확인 일치여부 체크 */
	  			memberPwRe.keyup(function(){
	  				
					if(memberPwRe.val() !== memberPw.val()){
						memberPwReCk.show();
	  				}
	  				if(memberPwRe.val() === memberPw.val()){
	  					memberPwReCk.hide();
	  				}
	  				
	  			})
  					
  			
	  			
		  		$('.comment_button').click(function(){
		  			
		  			//주소 합쳐서 하나의 input박스에 넣기
		  			var address1 = $('#regionMagjor').val();
					var address2 = $('#regionMinor').val();
					var address3 = $('#regionDetail').val();
					var resultAddr = address1 +" "+ address2 +" "+ address3;
				  	$('#memberAddress').val(resultAddr);
		  			
		  			/* 아이디, 비밀번호 체크 유효성검사 */
		  			if('inline-block' == memberIdCk.css('display')){
		  				memberId.focus();
		  				return false;
		  			}
		  			if('inline-block' == memberPwCk.css('display')){
		  				memberPw.focus();
		  				return false;
		  			}
		  			if('inline-block' == memberPwReCk.css('display')){
		  				memberPwRe.focus();
		  				return false;
		  			}
		  			
			  		/* select박스 유효성체크 */
		  			if('도' == regionMagjor.val()){
		  				regionMagjorCk.show();
		  				regionMagjor.focus();
		  				return false;
		  			}
		  			if('도' != regionMagjor.val()){
		  				regionMagjorCk.hide();
		  			}
		  			
		  			if('' == regionMinor.val()){
		  				regionMinorCk.show();
		  				regionMinor.focus();
		  				return false;
		  			}
		  			if('' != regionMinor.val()){
		  				regionMinorCk.hide();
		  			}
		  			
		  			if('' == libraryName.val()){
		  				libraryNameCk.show();
		  				libraryName.focus();
		  				return false;
		  			}
		  			if('' != libraryName.val()){
		  				libraryNameCk.hide();
		  			}
		  			
		  		});
		  		
		  		
				/* 지역소분류(시) 화면 출력 */
				$('#regionMagjor').change(function(){
					
					var request = $.ajax({
									  url: "/selectRegionMinor",
									  method: "get",
									  data: { regionMagjor : $('#regionMagjor').val() },
									  dataType: "json"
								});
				 			 
					request.done(function( data ) {
						console.log(data);
						var html = '<option value="">시</option>';
						for(var i=0; i<data.length; i++){
							html += '<option value="'+data[i].regionMinor+'">'+data[i].regionMinor+'</option>';
						}
						$('#regionMinor').html(html);
					});
					 
					request.fail(function( jqXHR, textStatus ) {
						alert( "Request failed: " + textStatus );
					});
				
				});

		  		/* 입력된 지역으로 지역도서관 화면출력 */	
				$('#regionMinor').change(function(){
					
			  		var region = [ $('#regionMagjor :selected').val(), $('#regionMinor :selected').val()];	
			  		console.log(region);
			  		
			  		var libraryCode =  $.ajax({
											url: "/selectLibraryCode",
											method: "get",
											data: { region : region },
											traditional : true,
											dataType: "json"
							  			});	
				  		
			  		libraryCode.done(function( data ) {
				  		console.log(data);
				  		var libraryName = '<option value="">주변 도서관</option>';
				  		for(var i=0; i<data.length; i++){
				  			libraryName += '<option value="'+data[i].libraryCode+'">'+data[i].libraryName+'</option>';
						}
				  		$('#libraryName').html(libraryName);
			  		});
				  			 
			  		libraryCode.fail(function( jqXHR, textStatus ) {
		  			  alert( "Request failed: " + textStatus );
	  				});
			  		
				});
		  		
		  		
			})
		</script>
	</th:block>
</html>