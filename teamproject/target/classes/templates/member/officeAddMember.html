<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  		xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
  layout:decorator="@{layout/defaultAdmin}">

	<th:block layout:fragment="customTitle">
		<title>회원 등록</title>
	</th:block>
	
	<th:block layout:fragment="customCss">
		<!-- overlayScrollbars -->
  		<link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
		<!-- Tempusdominus Bbootstrap 4 -->
		<link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
	</th:block>
	
	<th:block layout:fragment="customContents">
		<div class="content-wrapper">
		 	<section class="content-header">
				<div class="register-logo">
					<a>회원 등록</a>
				</div>
			</section>
			<section class="content">
				<div class="container-fluid">
			        <div class="row">
			          	<!-- left column -->
						<div class="col-md-8 offset-2">
						  	<!-- jquery validation -->
							<div class="card card-primary card-outline">
							 	<!-- form start -->
								<form action= "/addMember" method="post" role="form" id="quickForm">
									<div class="card-body">
										<div class="form-group">
											<label for="exampleInputmemberId1">아이디</label>
											<input type="text" name="memberId" class="form-control" id="memberId" placeholder="아이디">
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">비밀번호</label>
											<input type="password" name="memberPw" class="form-control" id="memberPw" placeholder="비밀번호">
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">비밀번호 재확인</label>
											<input type="password" name="memberPwCk" class="form-control" id="memberPwCk" placeholder="비밀번호 재확인">
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">이름</label>
											<input type="text" name="memberName" class="form-control" id="memberName" placeholder="이름">
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">생년월일</label>
											<div class="input-group date" id="reservationdate" data-target-input="nearest">
						                        <input type="text" name="memberBirth" class="form-control datetimepicker-input" data-target="#reservationdate" placeholder="생년월일">
						                        <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
						                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
						                        </div>
						                    </div>
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">주소</label>
											<div class="row">
												<div class="col-md-6">
													<select name = "regionMagjor" id="regionMagjor" title="주소(도)를 선택해주세요." class="form-control">
														<option value="">도</option>
														<option th:each=" r: ${regionMagjor}" th:value="${r.regionMajor}">[[${r.regionMajor}]]</option>
							                        </select>
												</div>
												<div class="col-md-6">
													<select name = "regionMinor" id="regionMinor" class="form-control">
							                        	<option value="">시</option>
							                        </select>
												</div>
											</div>
											<hr>
											<input type="text" name="regionDetail" class="form-control" id="regionDetail" placeholder="상세 주소">
											<input type="hidden" name="memberAddress" id="memberAddress">
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">휴대폰번호</label>
											<input type="text" name="memberTel" class="form-control" id="memberTel" placeholder="휴대폰번호">
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">이메일</label>
											<input type="text" name="memberEmail" class="form-control" id="memberEmail" placeholder="이메일">
										</div>
										<div class="form-group" style ="display: none;">
											<label for="exampleInputPassword1">가입한 도서관</label>
											<input type="text" name="libraryCode" id="libraryName" th:value="${session.SLIBRARY}">
										</div>
										<div class="form-group" style ="display: none;">
											<label for="exampleInputPassword1">등록 직원아이디</label>
											<input type="text" name="officerId" id="officerId" th:value="${session.SID}">
										</div>
									</div>
								  	<!-- /.card-body -->
									<div class="col-md-2 offset-10" style="margin-bottom: 30px;">
										<button type="submit" class="btn btn-primary" >회원등록</button>
									</div>
								</form>
							</div>
						  	<!-- /.card -->
						</div>
						<!--/.col (left) -->
						<div class="col-md-6">
						</div>
			        </div>
			        <!-- /.row -->
     			</div><!-- /.container-fluid -->
         	</section>	
		</div>	
	</th:block>
	<th:block layout:fragment="customFooterScript">
		<!-- OPTIONAL SCRIPTS -->
		<script src="dist/js/demo.js"></script>
		<!-- overlayScrollbars -->
		<script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
		<!-- ionicons.com 아이콘 -->
		<script src="https://unpkg.com/ionicons@5.0.0/dist/ionicons.js"></script>
		<!-- PAGE PLUGINS -->
		<!-- jQuery Mapael -->
		<script src="plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
		<script src="plugins/raphael/raphael.min.js"></script>
		<script src="plugins/jquery-mapael/jquery.mapael.min.js"></script>
		<script src="plugins/jquery-mapael/maps/usa_states.min.js"></script>
		<!-- ChartJS -->
		<script src="plugins/chart.js/Chart.min.js"></script>
		<!-- jquery-validation -->
		<script src="plugins/jquery-validation/jquery.validate.min.js"></script>
		<script src="plugins/jquery-validation/additional-methods.min.js"></script>
		<!-- Select2 -->
		<script src="plugins/select2/js/select2.full.min.js"></script>
		<!-- InputMask -->
		<script src="plugins/moment/moment.min.js"></script>
		<script src="plugins/inputmask/min/jquery.inputmask.bundle.min.js"></script>
		<!-- bootstrap color picker -->
		<script src="plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
		<!-- Tempusdominus Bootstrap 4 -->
		<script src="plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
		
	
		<script type="text/javascript">
			$(function () {
				
				/* 유효성검사 */
				$.validator.setDefaults({
					submitHandler: function (from) {
						var address1 = $('#regionMagjor').val();
						var address2 = $('#regionMinor').val();
						var address3 = $('#regionDetail').val();
						var resultAddr = address1 +" "+ address2 +" "+ address3;
					  	$('#memberAddress').val(resultAddr);
					  	
					  	$(from).submit();
					}
				});
				$('#quickForm').validate({
					onkeyup: function(element){
						$(element).valid()
					},
					rules: {
						memberId: {
						   required: true,
						   minlength: 5,
						   remote:{
								url: "/selectCheckMemberId",
								method: "get"
								}
						},
						memberPw: {
						  required: true,
						  minlength: 5
						},
						memberPwCk: {
						  required: true,
						  equalTo: "input[name='memberPw']"
						},
						memberName: {
						  required: true
						},
						memberBirth: {
						  required: true
						},
						regionMagjor: {
						  required: true
						},
						regionMinor: {
						  required: true
						},
						regionDetail: {
						  required: true
						},
						memberTel: {
						  required: true
						},
						memberEmail: {
						  required: true
						}
					},
					messages: {
						memberId: {
						   required: "아이디를 입력해주세요.",
						   minlength: "5자 이상인 아이디를 입력해 주세요.",
						   remote : "존재하는 아이디입니다."
						},
						memberPw: {
						  required: "비밀번호를 입력해주세요.",
						  minlength: "5자 이상인 비밀번호를 입력해 주세요."
						},
						memberPwCk: {
						  required: "비밀번호를 다시 입력해주세요.",
						  equalTo: "비밀번호가 일치하지 않습니다."
						},
						memberName: {
						  required: "이름을 입력해주세요.",
						},
						memberBirth: {
						  required: "생년월일을 입력해주세요.",
						},
						regionMagjor: {
						  required: "주소(도)를 선택해주세요.",
						},
						regionMinor: {
						  required: "주소(시)를 선택해주세요.",
						},
						regionDetail: {
						  required: "상세 주소를 입력해주세요.",
						},
						memberTel: {
						  required: "휴대폰번호를 입력해주세요.",
						},
						memberEmail: {
						  required: "이메일을 입력해주세요.",
						}
					},
				  	errorElement: 'span',
					errorPlacement: function (error, element) {
					  error.addClass('invalid-feedback');
					  element.closest('.form-group').append(error);
					},
					highlight: function (element, errorClass, validClass) {
					  $(element).addClass('is-invalid');
					},
					unhighlight: function (element, errorClass, validClass) {
					  $(element).removeClass('is-invalid');
					}
				  
				});
			  
			
				
				var regionMagjor = $('#regionMagjor');
				var regionMinor = $('#regionMinor');
				var regionMagjorCk = $('#regionMagjorCk');
				var regionMinorCk = $('#regionMinorCk');
						
				/* 지역소분류(시) 화면 출력 */
				$('#regionMagjor').change(function(){
					
					var request = $.ajax({
						  url: "/selectRegionMinor",
						  method: "get",
						  data: { regionMagjor : $('#regionMagjor').val() },
						  dataType: "json"
					});
				 			 
					request.done(function( data ) {
						console.log(data);
						var html = '<option value="">시</option>';
						for(var i=0; i<data.length; i++){
							html += '<option value="'+data[i].regionMinor+'">'+data[i].regionMinor+'</option>';
						}
						$('#regionMinor').html(html);
					});
					 
					request.fail(function( jqXHR, textStatus ) {
						alert( "Request failed: " + textStatus );
					});
				
				});
			
				
			    //달력(Date range picker)
			    $('#reservationdate').datetimepicker({
			        format: 'YYYY-MM-DD'
			    });
			
			 })
		</script>
	</th:block>
	
	
</html>